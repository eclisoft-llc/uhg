
create or replace view FOUNDATION.EPIM_PROV_DEA_DEDUP(
	EPIM_ID,
	IDENTIFIER,
	EPIM_ID_CNT,
	START_DATE,
	END_DATE
) as
SELECT DISTINCT
FIRST_VALUE(EPIM_IDENTIFIER ) OVER(PARTITION BY IDENTIFIER ORDER BY EPIM_IDENTIFIER) EPIM_ID,
IDENTIFIER,
count(EPIM_IDENTIFIER) OVER (PARTITION BY IDENTIFIER ) EPIM_ID_CNT,
START_DATE,
END_DATE
FROM
(SELECT DISTINCT
 EPIM_IDENTIFIER ,
IDENTIFIER,
CASE WHEN PERIOD_START_DATE ='(null)' THEN '1900-01-01' ELSE substring(to_char(PERIOD_START_DATE),1,10) END START_DATE,
CASE WHEN PERIOD_END_DATE ='(null)' THEN '9999-12-31' ELSE substring(to_char(PERIOD_END_DATE),1,10) END END_DATE
FROM  ETL.EPIM_PROVIDER_IDENTIFIER_L where  IDENTIFIER_TYPE_CODE='DEA');

