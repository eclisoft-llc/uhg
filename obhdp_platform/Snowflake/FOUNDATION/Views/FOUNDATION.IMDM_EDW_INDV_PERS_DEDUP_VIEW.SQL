CREATE OR REPLACE VIEW FOUNDATION.IMDM_EDW_INDV_PERS_DEDUP AS
SELECT DISTINCT
   INDV_SRC_ID,
   FIRST_VALUE(INDV_KEY_VAL) OVER(PARTITION BY INDV_SRC_ID ORDER BY INDV_SRC_ID) PERS_SYS_ID,
   COUNT(INDV_KEY_VAL) OVER(PARTITION BY INDV_SRC_ID ) PERS_COUNT
FROM COMPACT.IMDM_EDW_INDV_KEY
WHERE LOWER(INDV_KEY_TYP_REF_DESC) = 'edwpersonidentifier' ;
